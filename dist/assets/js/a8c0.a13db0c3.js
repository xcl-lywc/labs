(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["a8c0"],{a8c0:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-wrap-box"},[a("el-card",{staticClass:"title-card"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("学年学期")])],1)],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"router-view-wrap"},[a("div",{staticClass:"router-view-content"},[e.common.checkAuthority("SchoolYear-tree",!0)?a("el-row",{staticClass:"padding-row"},[a("el-col",{attrs:{span:24}}),a("el-col",{attrs:{span:24}},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:!!e.filterText||!e.common.checkAuthority("SchoolYeardd_AddYear",!0)},on:{click:function(t){e.showDialog(null,"addYear")}}},[e._v("添加学年")])],1),a("el-tree",{attrs:{data:e.treeData,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,o=t.data;return a("span",{staticClass:"fill-width"},[a("div",{on:{mouseenter:function(t){e.mouseenter(o)},mouseleave:function(t){e.tempId=null}}},[a("span",[1==o.type_id?a("i",{staticClass:"fa fa-desktop text-primary"}):e._e(),2==o.type_id?a("i",{staticClass:"fa fa-mouse-pointer text-info"}):e._e(),e._v("\n                  "+e._s(i.label)+" \n                  "),a("span",{staticClass:"marl10",staticStyle:{color:"#ccc","font-size":"14px"}},[e._v(e._s(2==o.type_id?"（时段："+e.common._convertDate(o.start_time,"yyyy-MM-dd")+" ~ "+e.common._convertDate(o.end_time,"yyyy-MM-dd")+"）":""))]),e._v("    \n                  "),e.tempId==o.id?a("span",[1==o.type_id&&e.common.checkAuthority("SchoolYear_AddSchool",!0)?a("el-button",{attrs:{type:"text",disabled:!e.common.checkAuthority("SchoolYear_AddSchool",!0)},on:{click:function(t){t.stopPropagation(),e.showDialog(o,"addSchool")}}},[e._v("添加学期")]):e._e(),e.common.checkAuthority("SchoolYear_Edit",!0)?a("el-button",{attrs:{type:"text"},on:{click:function(t){t.stopPropagation(),e.showDialog(o,"edit")}}},[e._v("编辑")]):e._e(),e.common.checkAuthority("SchoolYear_delete",!0)?a("el-button",{staticClass:"text-danger",attrs:{type:"text"},on:{click:function(t){t.stopPropagation(),e.deleteTree(o)}}},[e._v("删除")]):e._e()],1):e._e()])])])}}])})],1)],1):e._e()],1)]),a("el-dialog",{attrs:{title:("edit"==e.editOrAdd?"编辑":"添加")+("addYear"==e.editOrAdd?"学年":"学期"),visible:e.dialogVisible,width:"50vw"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"schoolYearForm",attrs:{model:e.schoolYearForm,"label-width":"100px"}},["addYear"==e.editOrAdd||"edit"==e.editOrAdd&&1==e.typeId?a("el-form-item",{attrs:{label:"学年",prop:"name",rules:[{required:!0,message:"请输入学年",trigger:"blur"}]}},[a("el-date-picker",{attrs:{type:"year",placeholder:"选择年"},model:{value:e.schoolYearForm.name,callback:function(t){e.$set(e.schoolYearForm,"name",t)},expression:"schoolYearForm.name"}})],1):e._e(),"addSchool"==e.editOrAdd||"edit"==e.editOrAdd&&2==e.typeId?a("el-form-item",{attrs:{label:"学期名称",prop:"name"}},[a("el-input",{model:{value:e.schoolYearForm.name,callback:function(t){e.$set(e.schoolYearForm,"name",t)},expression:"schoolYearForm.name"}})],1):e._e(),"addSchool"==e.editOrAdd||"edit"==e.editOrAdd&&2==e.typeId?a("el-form-item",{attrs:{label:"开始结束时间",prop:"dateTime"}},[a("el-date-picker",{attrs:{"picker-options":e.startDatePicker,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.schoolYearForm.dateTime,callback:function(t){e.$set(e.schoolYearForm,"dateTime",t)},expression:"schoolYearForm.dateTime"}})],1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("schoolYearForm")}}},[e._v("确 定")])],1)],1)],1)},o=[],r=(a("7f7f"),a("cadf"),a("551c"),a("097d"),{data:function(){var e=this;return{startDatePicker:{disabledDate:function(t){return!e.tempYearName||t.getTime()<new Date("".concat(e.tempYearName,"-01-01")).getTime()}},isLoading:!1,dialogVisible:!1,treeData:null,defaultProps:{children:"childrens",label:"name"},tempData:null,tempId:null,typeId:1,editOrAdd:"add",tempYearName:null,filterText:null,schoolYearForm:{name:null,parent_id:null,start_time:null,end_time:null,type_id:this.typeId,dateTime:[]}}},watch:{},mounted:function(){this.initTree()},methods:{mouseenter:function(e){this.tempId=e.id,1==e.type_id&&(this.tempYearName=e.name)},initTree:function(){var e=this;this.isLoading=!0;var t={method:"post",url:"".concat(this.common.basePath,"/configSemester/tree"),data:{}};this.axios(t).then(function(t){e.treeData=t.data.data,e.isLoading=!1}).catch(function(t){e.isLoading=!1,e.$message.error(t)})},showDialog:function(e,t){this.tempData=e,this.editOrAdd=t,this.typeId=e?e.type_id:this.typeId=1,this.schoolYearForm.parent_id=e?e.parent_id:null,this.schoolYearForm.name=e?e.name:null,"edit"==t&&2==this.typeId&&(this.schoolYearForm.dateTime=[new Date(e.start_time),new Date(e.end_time)]),"addSchool"==t&&(this.schoolYearForm.name=null,this.schoolYearForm.dateTime=[new Date("".concat(this.tempYearName,"-01-01")),new Date("".concat(this.tempYearName,"-01-02"))]),"addYear"==t&&(this.schoolYearForm.name=null),this.dialogVisible=!0},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){e?"edit"==t.editOrAdd?t._updateSubmit():t._addSubmit():t.$message.error("请输入必填项")})},_addSubmit:function(){var e=this;this.axios.post("".concat(this.common.basePath,"/configSemester"),this.submitParams()).then(function(t){e.initTree(),e.$message.success(t.data.meta.message),e.dialogVisible=!1}).catch(function(t){e.dialogVisible=!1,e.$message.error(t)})},_updateSubmit:function(){var e=this;this.axios.patch("".concat(this.common.basePath,"/configSemester/").concat(this.tempData.id),this.submitParams()).then(function(t){e.initTree(),e.$message.success(t.data.meta.message),e.dialogVisible=!1}).catch(function(t){e.dialogVisible=!1,e.$message.error(t)})},submitParams:function(){if("addYear"==this.editOrAdd||"edit"==this.editOrAdd&&1==this.typeId)return{name:this.common._convertDate(this.schoolYearForm.name,"yyyy"),type_id:1};if("addSchool"==this.editOrAdd||"edit"==this.editOrAdd&&2==this.typeId){var e="addSchool"==this.editOrAdd?this.tempData.id:this.tempData.parent_id;return{name:this.schoolYearForm.name,parent_id:e,start_time:this.schoolYearForm.dateTime[0].getTime(),end_time:this.schoolYearForm.dateTime[1].getTime(),type_id:2}}},deleteTree:function(e){var t=this;this.authorityForm=JSON.parse(JSON.stringify(e)),this.$confirm("删除后需要重新添加","确认删除?",{"confirmButt才去onText":"确定",cancelButtonText:"取消",type:"warning"}).then(function(a){var i={method:"patch",url:"".concat(t.common.basePath,"/configSemester/delete/").concat(e.id)};t.axios(i).then(function(e){t.$message.success(e.data.meta.message),t.initTree()}).catch(function(e){t.$message.error(e)})}).catch(function(e){})}}}),s=r,n=a("2877"),d=Object(n["a"])(s,i,o,!1,null,null,null);d.options.__file="SchoolYear.vue";t["default"]=d.exports}}]);
//# sourceMappingURL=a8c0.a13db0c3.js.map