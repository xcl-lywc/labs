(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3a4a"],{"0632":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-wrap-box"},[a("el-card",{staticClass:"title-card"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("授权管理")])],1)],1),a("div",{staticClass:"router-view-wrap"},[a("div",{staticClass:"router-view-content"},[e.common.checkAuthority("Empower-list",!0)?a("div",[a("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"角色："}},[a("el-select",{staticClass:"fill-width",attrs:{placeholder:"请选择角色"},model:{value:e.searchForm.role,callback:function(t){e.$set(e.searchForm,"role",t)},expression:"searchForm.role"}},e._l(e.roleListData,function(e,t){return a("el-option",{key:"角色"+t,attrs:{value:e.id,label:e.role_name}})}))],1)],1),e.common.checkAuthorityTree("Faculty-tree")?a("el-col",{attrs:{span:8}},[e.facultyTreeData?a("el-form-item",{attrs:{label:"系别："}},[a("el-cascader",{staticClass:"fill-width",attrs:{options:e.facultyTreeData,props:e.facultyProps,"change-on-select":"",placeholder:"请选择系别"},model:{value:e.facultyChoosed,callback:function(t){e.facultyChoosed=t},expression:"facultyChoosed"}})],1):e._e()],1):e._e(),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"工号/学号："}},[a("el-input",{staticClass:"fill-width",attrs:{placeholder:"请输入学号"},model:{value:e.searchForm.account,callback:function(t){e.$set(e.searchForm,"account",t)},expression:"searchForm.account"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"姓名："}},[a("el-input",{staticClass:"fill-width",attrs:{placeholder:"请输入姓名"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"入校时间："}},[a("el-date-picker",{staticClass:"fill-width",attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.timeRange,callback:function(t){e.$set(e.searchForm,"timeRange",t)},expression:"searchForm.timeRange"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"年级：",prop:"grade_num"}},[a("el-input",{attrs:{type:"number"},model:{value:e.searchForm.grade_num,callback:function(t){e.$set(e.searchForm,"grade_num",t)},expression:"searchForm.grade_num"}},[a("template",{slot:"append"},[e._v("届")])],2)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:" "}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.getUserList(1,"tableData","searchForm",!0)}}},[e._v("搜索")]),a("el-button",{attrs:{type:"default"},on:{click:function(t){e.clearSearchForm("searchForm")}}},[e._v("重置")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.tableData.rows}},[a("el-table-column",{attrs:{label:"姓名",prop:"name",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"性别",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferGender(t.row.sex)))]}}])}),a("el-table-column",{attrs:{label:"工号/学号",prop:"account",width:"150"}}),a("el-table-column",{attrs:{label:"院系",prop:"faculty",width:"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"年级",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.grade_num?t.row.grade_num+"届":""))]}}])}),a("el-table-column",{attrs:{label:"班级",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.class_num?t.row.class_num+"班":""))]}}])}),a("el-table-column",{attrs:{label:"手机",prop:"phone_num",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"邮箱",prop:"mail",width:"250","show-overflow-tooltip":""}}),e._v("transferPersonStatus\n          "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferPersonStatus(t.row.cur_status)))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini",disabled:!e.common.checkAuthority("Empower-deletePower",!0)},on:{click:function(a){e.deleteUser(t.row)}}},[e._v("删除")])]}}])})],1)],1):a("div",{staticClass:"text-center text-info"},[e._v(" 你无权查看此内容 ")])]),e.common.checkAuthority("Empower-list",!0)?a("div",{staticClass:"router-view-bottom"},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:!e.common.checkAuthority("Empower-addPower",!0)},on:{click:e.addPower}},[e._v("添加授权")])],1),a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next","current-page":e.pageNum,"page-size":e.pageSize,total:e.tableData.total},on:{"size-change":e.pageSizeChange,"current-change":e.pageCurrentChange}})],1):a("div",{staticClass:"router-view-bottom"},[a("div")]),a("el-dialog",{attrs:{visible:e.dialogEmpowerVisible,title:"添加 "+e.activeRoleName+" 的授权",width:"80vw"},on:{"update:visible":function(t){e.dialogEmpowerVisible=t}}},[a("el-form",{ref:"dialogSearchForm",attrs:{model:e.dialogSearchForm,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:8}},[e.facultyTreeData?a("el-form-item",{attrs:{label:"系别："}},[a("el-cascader",{staticClass:"fill-width",attrs:{options:e.facultyTreeData,props:e.facultyProps,"change-on-select":"",placeholder:"请选择系别"},model:{value:e.dialogFacultyChoosed,callback:function(t){e.dialogFacultyChoosed=t},expression:"dialogFacultyChoosed"}})],1):e._e()],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"工号/学号："}},[a("el-input",{staticClass:"fill-width",attrs:{placeholder:"请输入学号"},model:{value:e.dialogSearchForm.account,callback:function(t){e.$set(e.dialogSearchForm,"account",t)},expression:"dialogSearchForm.account"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"姓名："}},[a("el-input",{staticClass:"fill-width",attrs:{placeholder:"请输入姓名"},model:{value:e.dialogSearchForm.name,callback:function(t){e.$set(e.dialogSearchForm,"name",t)},expression:"dialogSearchForm.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"入校时间："}},[a("el-date-picker",{staticClass:"fill-width",attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.dialogSearchForm.timeRange,callback:function(t){e.$set(e.dialogSearchForm,"timeRange",t)},expression:"dialogSearchForm.timeRange"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:" "}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.getUserList(2,"dialogTableData","dialogSearchForm",!0)}}},[e._v("搜索")]),a("el-button",{attrs:{type:"default"},on:{click:function(t){e.clearSearchForm("dialogSearchForm")}}},[e._v("重置")])],1)],1)],1)],1),a("hr"),a("h3",{staticClass:"text-info"},[e._v("待选人员")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogTableLoading,expression:"dialogTableLoading"}],attrs:{data:e.dialogTableData.rows}},[a("el-table-column",{attrs:{label:"姓名",prop:"name",width:"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferGender(t.row.sex)))]}}])}),a("el-table-column",{attrs:{label:"工号/学号",prop:"account",width:"150"}}),a("el-table-column",{attrs:{label:"院系",prop:"faculties_name",width:"150"}}),a("el-table-column",{attrs:{label:"手机",prop:"phone_num",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"邮箱",prop:"mail",width:"150","show-overflow-tooltip":""}}),e._v("transferPersonStatus\n        "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferPersonStatus(t.row.cur_status)))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addToChoosed(t.row)}}},[e._v("添加")])]}}])})],1),a("div",{staticClass:"text-right"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.dialogPageNum,"page-size":e.dialogPageSize,total:e.dialogTableData.total},on:{"current-change":e.dialogPageCurrentChange}})],1),a("hr"),a("h3",{staticClass:"text-info"},[e._v("已选人员")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.hasChoosed}},[a("el-table-column",{attrs:{label:"姓名",prop:"name",width:"100","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferGender(t.row.sex)))]}}])}),a("el-table-column",{attrs:{label:"工号/学号",prop:"account",width:"150"}}),a("el-table-column",{attrs:{label:"院系",prop:"faculties_name",width:"150"}}),a("el-table-column",{attrs:{label:"手机",prop:"phone_num",width:"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"邮箱",prop:"mail",width:"150","show-overflow-tooltip":""}}),e._v("transferPersonStatus\n        "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.common.transferPersonStatus(t.row.cur_status)))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){e.removeFromChoosed(t.row)}}},[e._v("移除")])]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogEmpowerVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:!e.hasChoosed.length>0,loading:e.tableLoading},on:{click:e.submitEmpower}},[e._v("确 定")])],1)],1)],1)],1)},l=[],i=(a("6b54"),a("ac6a"),a("4328")),s=a.n(i),r={components:{},data:function(){return{roleListData:[],searchForm:{role:null,timeRange:[]},activeRole:null,facultyChoosed:[],facultyTreeData:null,facultyProps:{children:"childrens",label:"faculty",value:"id"},pageNum:1,pageSize:10,tableLoading:!1,tableData:{rows:[],total:0},multipleSelection:[],dialogEmpowerVisible:!1,dialogTableLoading:!1,dialogSearchForm:{timeRange:[]},dialogFacultyChoosed:[],dialogTableData:[],hasChoosed:[],dialogPageNum:1,dialogPageSize:5,hasChoosedPageNum:1,hasChoosedPageSize:10,rules:{user_name:[{required:!0,message:"请输入用户名",trigger:"blur"}],account:[{required:!0,message:"请输入工号/学号",trigger:"blur"}],facultys:[{required:!0,message:"请选择院系",trigger:"change"}]}}},computed:{activeRoleName:function(){var e=this,t=null;return this.roleListData.forEach(function(a){a.id==e.activeRole&&(t=a.role_name)}),t}},watch:{"searchForm.role":{handler:function(e,t){e&&(this.activeRole=e)},deep:!0}},mounted:function(){this.initRoleList(),this.initFacultyTree()},methods:{initRoleList:function(e,t){var a=this;this.pageLoading=!0;var o={method:"get",url:"".concat(this.common.basePath,"/roles/list")};this.axios(o).then(function(e){a.roleListData=e.data.data,a.activeRole=e.data.data[0].id,a.searchForm.role=e.data.data[0].id,a.getUserList(1,"tableData","searchForm",!0),a.pageLoading=!1}).catch(function(e){a.pageLoading=!1,a.$message.error(e)})},initFacultyTree:function(){var e=this;this.pageLoading=!0;var t={method:"get",url:"".concat(this.common.basePath,"/faculty/tree")};this.axios(t).then(function(t){e.facultyTreeData=t.data.data,e.activeNode=t.data.data[0].id,e.pageLoading=!1}).catch(function(t){e.pageLoading=!1,e.$message.error(t)})},getUserList:function(e,t,a,o){var l=this,i=JSON.parse(JSON.stringify(this[a]));"tableData"==t?(this.tableLoading=!0,o&&(this.pageNum=1,this.pageSize=10),i.pageNum=this.pageNum,i.pageSize=this.pageSize,this.facultyChoosed.length>0&&(i.faculty=this.facultyChoosed[this.facultyChoosed.length-1])):"dialogTableData"==t&&(this.dialogTableLoading=!0,o&&(this.dialogPageNum=1,this.dialogPageSize=5),i.pageNum=this.dialogPageNum,i.pageSize=this.dialogPageSize,this.dialogFacultyChoosed.length>0&&(i.faculty=this.dialogFacultyChoosed[this.dialogFacultyChoosed.length-1]),i.role=this.activeRole),i.timeRange.length>0&&(i.sTime=i.timeRange[0],i.eTime=i.timeRange[1],delete i.timeRange),i.type=e;var s={method:"get",url:"".concat(this.common.basePath,"/authorize/user"),params:i};this.axios(s).then(function(e){l[t]=e.data.data,l.$nextTick(function(e){l.tableLoading=!1,l.dialogTableLoading=!1})}).catch(function(e){l.tableLoading=!1,l.dialogTableLoading=!1,l.$message.error(e)})},clearSearchForm:function(e){"searchForm"==e?(this[e]={role:this.roleListData[0].id,timeRange:[]},this.activeRole=this.roleListData[0].id,this.facultyChoosed=[]):(this[e]={timeRange:[]},this.dialogFacultyChoosed=[])},deleteUser:function(e){var t=this,a={method:"delete",url:"".concat(this.common.basePath,"/authorize/remove"),params:{ids:[e.userRoleId].join(",")}};this.$confirm("删除后需要重新添加","确认删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(e){t.tableLoading=!0,t.axios(a).then(function(e){t.$message.success(e.data.meta.message),t.getUserList(1,"tableData","searchForm",!0),t.$nextTick(function(e){t.tableLoading=!1})}).catch(function(e){t.tableLoading=!1,t.$message.error(e)})}).catch(function(e){})},addPower:function(){this.activeRole?(this.dialogSearchForm={timeRange:[]},this.dialogFacultyChoosed=[],this.dialogTableData={total:0,rows:[]},this.hasChoosed=[],this.dialogEmpowerVisible=!0):this.$message.error("请先选择角色")},pageSizeChange:function(e){this.pageSize=e,this.getUserList(1,"tableData","searchForm")},pageCurrentChange:function(e){this.pageNum=e,this.getUserList(1,"tableData","searchForm")},handleSelectionChange:function(e){this.multipleSelection=e},multiUpdateClicked:function(e){},dialogPageCurrentChange:function(e){this.dialogPageNum=e,this.getUserList(2,"dialogTableData","dialogSearchForm")},addToChoosed:function(e){this.hasChoosed.length<=0?this.hasChoosed.push(e):-1==this.hasChoosed.map(function(e){return e.id}).join(",").indexOf(e.id.toString())?this.hasChoosed.push(e):this.$message.error("该人员已在下方列表 , 请核对")},removeFromChoosed:function(e){for(var t=JSON.parse(JSON.stringify(this.hasChoosed)).length,a=0;a<t;a++)if(this.hasChoosed[a].id==e.id)return this.hasChoosed.splice(a,1),!1;console.log(this.hasChoosed)},submitEmpower:function(e){var t=this;this.tableLoading=!0;var a={method:"post",url:"".concat(this.common.basePath,"/authorize/add"),data:s.a.stringify({role:this.activeRole,ids:this.hasChoosed.map(function(e){return e.id}).join(",")})};this.axios(a).then(function(e){t.dialogEmpowerVisible=!1,t.$message.success(e.data.meta.message),t.getUserList(1,"tableData","searchForm",!0),t.$nextTick(function(e){t.tableLoading=!1})}).catch(function(e){t.tableLoading=!1,t.$message.error(e)})}}},n=r,c=(a("5a32"),a("2877")),d=Object(c["a"])(n,o,l,!1,null,null,null);d.options.__file="Empower.vue";t["default"]=d.exports},"5a32":function(e,t,a){"use strict";var o=a("d3d0"),l=a.n(o);l.a},d3d0:function(e,t,a){}}]);
//# sourceMappingURL=chunk-3a4a.1977cb21.js.map